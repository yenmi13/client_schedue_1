<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hipporizz Ë™øËâ≤Áõ§ÂæÆÂÖâÈ¢®Êâá - ÊôÇÁ®ãË°®</title>
    <style>
        :root {
            --ink: #1a1a1a;
            --paper: #fafafa;
            --gray-light: #f5f5f5;
            --gray-mid: #e0e0e0;
            --gray-dark: #888;
            --accent: #c41e3a;
            --accent-light: #fff0f3;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--paper);
            color: var(--ink);
            line-height: 1.6;
            padding: 2rem 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Password Gate */
        #passwordGate {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--ink);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .gate-box {
            background: white;
            padding: 3rem;
            border-radius: 8px;
            text-align: center;
            max-width: 320px;
        }

        .gate-box h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .gate-box p {
            color: var(--gray-dark);
            font-size: 0.85rem;
            margin-bottom: 1.5rem;
        }

        .gate-box input {
            width: 100%;
            padding: 0.8rem;
            font-size: 1.5rem;
            text-align: center;
            border: 2px solid var(--gray-mid);
            border-radius: 4px;
            letter-spacing: 0.5rem;
            margin-bottom: 1rem;
        }

        .gate-box button {
            width: 100%;
            padding: 0.8rem;
            background: var(--ink);
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }

        .gate-box .error {
            color: var(--accent);
            font-size: 0.8rem;
            margin-top: 1rem;
            display: none;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 2px solid var(--ink);
        }

        .header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        .subtitle {
            color: var(--gray-dark);
            font-size: 0.9rem;
            margin-top: 0.3rem;
        }

        .target-date {
            display: inline-block;
            background: var(--accent);
            color: white;
            padding: 0.4rem 1rem;
            border-radius: 4px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 1rem;
        }

        /* Stats */
        .stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            padding: 1.5rem;
            background: var(--gray-light);
            margin-bottom: 1.5rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--gray-dark);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Phase Timeline */
        .phase-timeline {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
            padding: 0.5rem 0;
        }

        .phase-item {
            flex: 1;
            min-width: 120px;
            padding: 1rem;
            background: var(--gray-light);
            text-align: center;
            text-decoration: none;
            color: var(--ink);
            transition: all 0.2s;
            cursor: pointer;
        }

        .phase-item:hover {
            background: var(--gray-mid);
        }

        .phase-item.active {
            background: var(--ink);
            color: white;
        }

        .phase-num {
            font-size: 0.65rem;
            font-weight: 600;
            opacity: 0.7;
        }

        .phase-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0.2rem 0;
        }

        .phase-date {
            font-size: 0.7rem;
            opacity: 0.7;
        }

        /* Controls */
        .controls {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .btn {
            padding: 0.6rem 1.2rem;
            border: 1px solid var(--gray-mid);
            background: white;
            cursor: pointer;
            font-size: 0.85rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .btn:hover {
            background: var(--gray-light);
            border-color: var(--ink);
        }

        /* Schedule Content */
        .schedule-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            padding: 0.8rem 0;
            border-bottom: 2px solid var(--ink);
            margin-bottom: 1rem;
        }

        .section-title:focus {
            outline: 2px solid var(--accent);
            outline-offset: 2px;
        }

        .week-block {
            background: white;
            border: 1px solid var(--gray-mid);
            margin-bottom: 1rem;
            padding: 1rem;
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--gray-light);
        }

        .week-title {
            font-weight: 700;
            font-size: 1rem;
        }

        .week-date {
            font-size: 0.8rem;
            color: var(--gray-dark);
        }

        /* Task List */
        .task-list {
            list-style: none;
        }

        .task-item {
            display: flex;
            align-items: flex-start;
            gap: 0.6rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--gray-light);
        }

        .task-item:last-of-type {
            border-bottom: none;
        }

        .checkbox {
            width: 18px;
            height: 18px;
            margin-top: 2px;
            cursor: pointer;
            flex-shrink: 0;
        }

        .task-text {
            flex: 1;
            font-size: 0.9rem;
            min-height: 1.4em;
        }

        .task-text.completed {
            text-decoration: line-through;
            color: var(--gray-dark);
        }

        .week-notes {
            width: 100%;
            margin-top: 1rem;
            padding: 0.8rem;
            border: 1px solid var(--gray-mid);
            border-radius: 4px;
            font-size: 0.85rem;
            font-family: inherit;
            resize: vertical;
            min-height: 60px;
            background: var(--gray-light);
        }

        .week-notes:focus {
            outline: 2px solid var(--accent);
            outline-offset: -2px;
            background: white;
        }

        .week-notes-label {
            font-size: 0.75rem;
            color: var(--gray-dark);
            margin-top: 0.8rem;
            margin-bottom: 0.3rem;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray-mid);
            font-size: 0.75rem;
            color: var(--gray-dark);
        }

        @media (max-width: 768px) {
            .stats {
                gap: 1rem;
            }

            .stat-value {
                font-size: 1.3rem;
            }

            .phase-item {
                min-width: 100px;
                padding: 0.8rem;
            }
        }
    </style>
</head>

<body>
    <!-- Password Gate -->
    <div id="passwordGate">
        <div class="gate-box">
            <h2>HIPPORIZZ</h2>
            <p>Â∞àÊ°àÊôÇÁ®ãËøΩËπ§Á≥ªÁµ±</p>
            <input type="password" id="accessCode" maxlength="4" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button onclick="checkCode()">ÈÄ≤ÂÖ•Á≥ªÁµ±</button>
            <p class="error" id="errorMsg">Â≠òÂèñÁ¢ºÈåØË™§</p>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="container" style="display: none;">
        <header class="header">
            <h1>Hipporizz Ë™øËâ≤Áõ§ÂæÆÂÖâÈ¢®Êâá</h1>

            <div class="target-date">ÁõÆÊ®ô‰∏äÁ∑öÔºö2026/03/03 (‰∫å)</div>
        </header>

        <!-- Stats Bar -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value">9</div>
                <div class="stat-label">Á∏ΩÈÄ±Êï∏</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="currentWeek">W1</div>
                <div class="stat-label">ÁõÆÂâçÈÄ≤Â∫¶</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="completionRate">0%</div>
                <div class="stat-label">ÂÆåÊàêÁéá</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="daysLeft">59</div>
                <div class="stat-label">Ââ©È§òÂ§©Êï∏</div>
            </div>
        </div>

        <!-- Phase Timeline -->
        <div class="phase-timeline">
            <a class="phase-item active" onclick="scrollToSection('phase1')">
                <div class="phase-num">PHASE 1</div>
                <div class="phase-name">Á±åÂÇôÊúü</div>
                <div class="phase-date">12/30 - 1/12</div>
            </a>
            <a class="phase-item" onclick="scrollToSection('phase2')">
                <div class="phase-num">PHASE 2</div>
                <div class="phase-name">È†êÁÜ±Êúü</div>
                <div class="phase-date">1/13 - 2/02</div>
            </a>
            <a class="phase-item" onclick="scrollToSection('phase3')">
                <div class="phase-num">PHASE 3</div>
                <div class="phase-name">Ë°ùÂà∫Êúü I</div>
                <div class="phase-date">2/03 - 2/12</div>
            </a>
            <a class="phase-item" onclick="scrollToSection('cny')">
                <div class="phase-num">üßß</div>
                <div class="phase-name">Êò•ÁØÄ‰ºëÂÅá</div>
                <div class="phase-date">2/13 - 2/23</div>
            </a>
            <a class="phase-item" onclick="scrollToSection('phase4')">
                <div class="phase-num">PHASE 4</div>
                <div class="phase-name">Ë°ùÂà∫Êúü II</div>
                <div class="phase-date">2/24 - 3/02</div>
            </a>
            <a class="phase-item" onclick="scrollToSection('phase5')">
                <div class="phase-num">PHASE 5</div>
                <div class="phase-name">‰∏äÁ∑öÊó•</div>
                <div class="phase-date">3/03</div>
            </a>
        </div>

        <!-- Import Control -->
        <div style="text-align: center; margin-bottom: 1.5rem;">
            <input type="file" id="mdFileInput" accept=".md" style="display: none;" onchange="importMDFile(this)">
            <label for="mdFileInput" class="btn" style="cursor: pointer;">üìÅ ÂåØÂÖ• .md Ê™îÊ°à</label>
        </div>
        <!-- Schedule Content -->
        <div id="scheduleContent">
            <!-- Content will be loaded here -->
        </div>

        <footer class="footer">
            <p>Powered by YMS | ÁõÆÊ®ô‰∏äÁ∑öÊó•Ôºö2026/03/03</p>
        </footer>
    </div>

    <script>
        // Password check
        function checkCode() {
            const code = document.getElementById('accessCode').value;
            if (code === "2026") {
                document.getElementById('passwordGate').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                initDashboard();
            } else {
                document.getElementById('errorMsg').style.display = 'block';
                document.getElementById('accessCode').value = '';
            }
        }

        document.getElementById('accessCode').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkCode();
        });

        // Initialize
        function initDashboard() {
            // Use v5 to clear old cache and sync with full_schedule.md
            const saved = localStorage.getItem('hipporizz_schedule_v5');
            if (saved) {
                document.getElementById('scheduleContent').innerHTML = saved;
                reattachListeners();
            } else {
                // Clear old cache data
                localStorage.removeItem('hipporizz_schedule_v3');
                localStorage.removeItem('hipporizz_schedule_v4');
                loadSchedule();
            }
            calculateDaysLeft();
            updateStats();
        }

        // Import .md file - only extract W0-W9 tasks
        function importMDFile(input) {
            const file = input.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const md = e.target.result;
                const weekTasks = parseWeekTasks(md);

                // Update the existing week blocks with imported tasks
                Object.keys(weekTasks).forEach(weekName => {
                    const weekBlocks = document.querySelectorAll('.week-block');
                    weekBlocks.forEach(block => {
                        const titleEl = block.querySelector('.week-title');
                        if (titleEl && titleEl.textContent.trim() === weekName) {
                            const taskList = block.querySelector('.task-list');
                            const addBtn = taskList.querySelector('.add-task-btn');

                            // Remove existing tasks (keep add button)
                            taskList.querySelectorAll('.task-item').forEach(t => t.remove());

                            // Add imported tasks
                            weekTasks[weekName].forEach(task => {
                                const li = createTaskItem(task.text, task.checked);
                                taskList.insertBefore(li, addBtn);
                            });
                        }
                    });
                });

                saveData();
                updateStats();
                alert('Â∑≤ÂåØÂÖ• ' + Object.keys(weekTasks).length + ' ÂÄãÈÄ±Ê¨°ÁöÑ‰ªªÂãôÔºÅ');
            };
            reader.readAsText(file);
            input.value = ''; // Reset for re-import
        }

        // Parse markdown to extract only W0-W9 tasks
        function parseWeekTasks(md) {
            const lines = md.split('\n');
            const weekTasks = {};
            let currentWeek = null;

            lines.forEach(line => {
                // Match week headers like "### W0", "### W1 (01/06 - 01/11)"
                const weekMatch = line.match(/^###\s+(W\d+)/i);
                if (weekMatch) {
                    currentWeek = weekMatch[1].toUpperCase();
                    weekTasks[currentWeek] = [];
                    return;
                }

                // If we're in a week section, look for tasks
                if (currentWeek) {
                    // Match checkbox items: "- [ ] task" or "- [x] task"
                    const taskMatch = line.match(/^-\s*\[([xX\s])\]\s*(.+)/);
                    if (taskMatch) {
                        weekTasks[currentWeek].push({
                            checked: taskMatch[1].toLowerCase() === 'x',
                            text: taskMatch[2].trim()
                        });
                    }

                    // Stop when hitting another section header
                    if (line.match(/^##\s+/) && !line.match(/^###/)) {
                        currentWeek = null;
                    }
                }
            });

            return weekTasks;
        }

        // Load schedule from markdown file
        function loadSchedule() {
            // Parse the schedule data directly (embedded for reliability)
            const scheduleData = [
                {
                    id: 'phase1',
                    title: 'Phase 1: Á±åÂÇôÊúü (12/30 - 01/12)',
                    weeks: [
                        {
                            name: 'W0',
                            date: '12/30 - 01/05',
                            tasks: [
                                'ÊéíÁ®ãË°®Á¢∫Ë™ç',
                                'ÂïèÂç∑Ë®≠Ë®à (SurveyCake)',
                                'Áî¢ÂìÅÁ¥†ÊùêÊãçÊîùÈ¢®Ê†ºÁ¢∫Ë™ç',
                                'ÊîùÂΩ±Â∏´Ê™îÊúüÁ¢∫Ë™çÔºà1Êúà‰∏≠ÂâçÂøÖÈ†àÊãçÂÆåÔºâ',
                                'ÊãçÊîùÊ®£ÂìÅÁãÄÊÖãÁ¢∫Ë™çÔºà+ÈúÄÁôºÈÄÅ3-5‰ªΩÁµ¶Á§æÁæ§Âêà‰ΩúÔºâ'
                            ]
                        },
                        {
                            name: 'W1',
                            date: '01/06 - 01/12',
                            tasks: [
                                'ÂïèÂç∑Êîæ‰∏ä SurveyCake',
                                'ÂïèÂç∑Á¥†ÊùêË£Ω‰Ωú',
                                'Hipporizz Âêà‰ΩúÂêàÁ¥Ñ',
                                'ÂΩ±Áâá&Âπ≥Èù¢ÊîùÂΩ±Â∏´Ê™îÊúüÁ¢∫Ë™ç',
                                'KOL ÂêçÂñÆÂàùÈÅ∏Ôºà10 ‰Ωç 1-5Ëê¨‰∫∫followerÔºâ',
                                'ÂõûÈ•ãÊñπÊ°àË®≠Ë®à',
                                'Áî¢ÂìÅÁ≠ñÁï•Á∞°Â†±'
                            ]
                        }
                    ]
                },
                {
                    id: 'phase2',
                    title: 'Phase 2: È†êÁÜ±Êúü (01/13 - 02/02)',
                    weeks: [
                        {
                            name: 'W2',
                            date: '01/13 - 01/19',
                            tasks: [
                                'KOL ËÅØÁπ´ & Brief ÁôºÈÄÅ',
                                'Á§æÁæ§ÂÖßÂÆπË¶èÂäÉ',
                                'ÊãçÊîùÁ¥†Êùê&ÂΩ±ÁâáËÖ≥Êú¨ÂÆöÊ°à',
                                'ÂïèÂç∑Âª£ÂëäÁ¢∫Ë™ç'
                            ]
                        },
                        {
                            name: 'W3',
                            date: '01/20 - 01/26',
                            tasks: [
                                'ÊîùÂΩ±Â∏´ÊãçÊîùÂπ≥Èù¢',
                                'ÊîùÂΩ±Â∏´ÂΩ±Áâá',
                                'ÂïèÂç∑È†ÅÈù¢‰∏äÁ∑ö + Âª£ÂëäÊäïÊîæÈñãÂßã',
                                'KOL Ë©¶Áî®Áî¢ÂìÅÂØÑÈÄÅ',
                                'ÂãüË≥áÈ†ÅÈù¢ÊñáÊ°àÂàùÁ®øÂÆåÊàê'
                            ]
                        },
                        {
                            name: 'W4',
                            date: '01/27 - 02/02',
                            tasks: [
                                'ÂïèÂç∑Âª£ÂëäÊåÅÁ∫åÊäïÊîæÔºà‰ΩéÊàêÊú¨ÊúüÔºâ',
                                'KOL Á¨¨‰∏ÄÊâπÂØÑÈÄÅ',
                                'ÂãüË≥áÈ†ÅÈù¢Á¥†ÊùêÔºãÂÖßÂÆπ',
                                'Âª£ÂëäÁ¥†ÊùêÂàùÊÆµÊ∫ñÂÇô'
                            ]
                        }
                    ]
                },
                {
                    id: 'phase3',
                    title: 'Phase 3: Ë°ùÂà∫Êúü I (02/03 - 02/12)',
                    weeks: [
                        {
                            name: 'W5',
                            date: '02/03 - 02/09',
                            tasks: [
                                'ÂãüË≥áÈ†ÅÈù¢ÊúÄÁµÇÁ¢∫Ë™ç',
                                'KOL Á¨¨‰∫åÊâπÂØÑÈÄÅ',
                                'KOL Á¨¨‰∏ÄÊâπÂÖßÂÆπÂØ©Ê†∏',
                                'Á¨¨‰∏ÄÊ≥¢ÂïèÂç∑Êï¥ÁêÜ',
                                'Ëµ∞ÊúüÂª£ÂëäÁ¥†ÊùêÂÆöÊ°à-6ÁµÑ'
                            ]
                        },
                        {
                            name: 'W6',
                            date: '02/10 - 02/12',
                            tasks: [
                                'ÂòñÂòñÈ†ÅÈù¢‰∏äÂàäÔºàÈ†êÁïô‰øÆÊîπÊôÇÈñìÔºâ',
                                'Á§æÁæ§ÂÖßÂÆπË¶èÂäÉ',
                                'ÂïèÂç∑EDM / Á∞°Ë®äÂêçÂñÆÊï¥ÁêÜ',
                                'KOL Á¨¨‰∫åÊâπÂÖßÂÆπÂØ©Ê†∏'
                            ]
                        }
                    ]
                },
                {
                    id: 'cny',
                    title: 'üßß Êò•ÁØÄ‰ºëÂÅá (02/13 - 02/23)',
                    weeks: [
                        {
                            name: 'üßß',
                            date: '02/13 - 02/23',
                            tasks: [
                                'KOLÁ¨¨‰∫åÊâπË£Ω‰ΩúÈ†ÅÈù¢Á¥†Êùê',
                                'ÂÉÖÁõ£ÊéßÊï∏ÊìöÔºå‰∏çÂÅö‰∏ªÂãïÊìç‰Ωú',
                                '2/24 Êî∂ÂÅáÂæåÁ´ãÂç≥ÈÄ≤ÂÖ•ÊúÄÁµÇË°ùÂà∫'
                            ]
                        }
                    ]
                },
                {
                    id: 'phase4',
                    title: 'Phase 4: Ë°ùÂà∫Êúü II (02/24 - 03/02)',
                    weeks: [
                        {
                            name: 'W7',
                            date: '02/24 - 03/02',
                            tasks: [
                                'KOLÁ¨¨‰∫åÊâπË£Ω‰ΩúÈ†ÅÈù¢Á¥†Êùê',
                                '‰∏äÁ∑öÂêçÂñÆÁ¢∫Ë™ç',
                                'ÊúÄÁµÇÂª£ÂëäÁ¥†ÊùêÁ¢∫Ë™ç',
                                'metaÈ†êÂëäÁôºÂ∏ÉÔºãÂÄíÊï∏Ë®àÊôÇ',
                                'ÂãüË≥áÈ†ÅÈù¢ÊúÄÁµÇÁ¢∫Ë™ç',
                                'ÊúÄÂæåÂïèÂç∑ÂêçÂñÆÊ∏ÖÊ¥ó & ÂàÜÁúæ',
                                'KOL Áôº‰ΩàÊôÇÈñìÁ¢∫Ë™ç'
                            ]
                        }
                    ]
                },
                {
                    id: 'phase5',
                    title: 'Phase 5: Launch Day (03/03)',
                    weeks: [
                        {
                            name: 'W8',
                            date: '03/03 (‰∫å)',
                            tasks: [
                                '11:00 - EDM ÁôºÈÄÅ',
                                '11:00 - È†ÅÈù¢ÈñãÊîæ',
                                '11:00 - Á§æÁæ§Ë≤ºÊñáÂêåÊ≠•ÁôºÂ∏É',
                                '12:00 - KOL Ë≤ºÊñáÂêåÊ≠•‰∏äÁ∑ö',
                                '12:00 - Á∞°Ë®äÊé®Êí≠',
                                '12:00 - Âª£ÂëäÂÖ®Èù¢ÈñãÂïü',
                                '19:00 - Ê™¢Ë¶ñÈ¶ñÊó•Êï∏ÊìöÔºåË™øÊï¥Âª£ÂëäÁ≠ñÁï•'
                            ]
                        }
                    ]
                }
            ];

            renderSchedule(scheduleData);
        }

        function renderSchedule(data) {
            const container = document.getElementById('scheduleContent');
            container.innerHTML = '';

            data.forEach(phase => {
                const section = document.createElement('section');
                section.className = 'schedule-section';
                section.id = phase.id;

                const title = document.createElement('h2');
                title.className = 'section-title';
                title.textContent = phase.title;
                section.appendChild(title);

                phase.weeks.forEach(week => {
                    const weekBlock = document.createElement('div');
                    weekBlock.className = 'week-block';
                    weekBlock.dataset.week = week.name;

                    weekBlock.innerHTML = `
                        <div class="week-header">
                            <span class="week-title">${week.name}</span>
                            <span class="week-date">${week.date}</span>
                        </div>
                    `;

                    const taskList = document.createElement('ul');
                    taskList.className = 'task-list';

                    week.tasks.forEach(task => {
                        const li = createTaskItem(task, false);
                        taskList.appendChild(li);
                    });

                    weekBlock.appendChild(taskList);

                    // Notes section
                    const notesLabel = document.createElement('div');
                    notesLabel.className = 'week-notes-label';
                    notesLabel.textContent = 'üìù ÂÇôË®ª';
                    weekBlock.appendChild(notesLabel);

                    const notes = document.createElement('textarea');
                    notes.className = 'week-notes';
                    notes.placeholder = 'ÂèØÂú®Ê≠§Ëº∏ÂÖ•Êú¨ÈÄ±ÂÇôË®ª...';
                    notes.dataset.week = week.name;
                    notes.addEventListener('blur', saveData);
                    weekBlock.appendChild(notes);

                    section.appendChild(weekBlock);
                });

                container.appendChild(section);
            });

            saveData();
        }

        function createTaskItem(text, checked) {
            const li = document.createElement('li');
            li.className = 'task-item';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.className = 'checkbox';
            checkbox.checked = checked;

            const span = document.createElement('span');
            span.className = 'task-text' + (checked ? ' completed' : '');
            span.textContent = text;

            // Events - only checkbox change
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) span.classList.add('completed');
                else span.classList.remove('completed');
                updateStats();
                saveData();
            });

            li.appendChild(checkbox);
            li.appendChild(span);

            return li;
        }

        function reattachListeners() {
            // Checkbox listeners
            document.querySelectorAll('.task-item').forEach(li => {
                const checkbox = li.querySelector('.checkbox');
                const span = li.querySelector('.task-text');

                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) span.classList.add('completed');
                    else span.classList.remove('completed');
                    updateStats();
                    saveData();
                });
            });

            // Notes listeners
            document.querySelectorAll('.week-notes').forEach(notes => {
                notes.addEventListener('blur', saveData);
            });
        }

        // Save & Load
        function saveData() {
            const html = document.getElementById('scheduleContent').innerHTML;
            localStorage.setItem('hipporizz_schedule_v5', html);
        }

        // Export to Markdown
        function exportToMD() {
            let md = '# Hipporizz ÊôÇÁ®ãË°®\n\n';

            document.querySelectorAll('.schedule-section').forEach(section => {
                const title = section.querySelector('.section-title');
                if (title) md += '## ' + title.textContent.trim() + '\n\n';

                section.querySelectorAll('.week-block').forEach(week => {
                    const weekTitle = week.querySelector('.week-title');
                    const weekDate = week.querySelector('.week-date');
                    md += '### ' + weekTitle.textContent + ' (' + weekDate.textContent + ')\n\n';

                    week.querySelectorAll('.task-item').forEach(item => {
                        const cb = item.querySelector('.checkbox');
                        const text = item.querySelector('.task-text');
                        const checked = cb && cb.checked ? 'x' : ' ';
                        if (text && text.textContent.trim()) {
                            md += '- [' + checked + '] ' + text.textContent.trim() + '\n';
                        }
                    });
                    md += '\n';
                });
            });

            const blob = new Blob([md], { type: 'text/markdown' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'hipporizz_schedule.md';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Clear current week
        function clearWeek() {
            if (!confirm('Á¢∫ÂÆöË¶ÅÊ∏ÖÁ©∫Êú¨ÈÄ±‰ªªÂãôÂóéÔºü')) return;
            // Find W1 (current week) and clear its tasks
            const w1 = document.querySelector('.week-block');
            if (w1) {
                const tasks = w1.querySelectorAll('.task-item');
                tasks.forEach(t => t.remove());
                saveData();
                updateStats();
            }
        }

        // Utilities
        function updateStats() {
            const checkboxes = document.querySelectorAll('.checkbox');
            let total = checkboxes.length;
            let completed = 0;
            checkboxes.forEach(cb => { if (cb.checked) completed++; });
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            document.getElementById('completionRate').textContent = rate + '%';
        }

        function calculateDaysLeft() {
            const target = new Date('2026-03-02');
            const diff = Math.ceil((target - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('daysLeft').textContent = diff > 0 ? diff : 0;
        }

        function scrollToSection(id) {
            const el = document.getElementById(id);
            if (el) el.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>

</html>